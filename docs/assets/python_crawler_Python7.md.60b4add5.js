import{_ as s,o as a,c as n,R as l}from"./chunks/framework.3bbe0c8b.js";const C=JSON.parse('{"title":"爬虫实战","description":"","frontmatter":{"layout":"doc","outline":"deep"},"headers":[],"relativePath":"python/crawler/Python7.md","filePath":"python/crawler/Python7.md"}'),p={name:"python/crawler/Python7.md"},o=l(`<h1 id="爬虫实战" tabindex="-1">爬虫实战 <a class="header-anchor" href="#爬虫实战" aria-label="Permalink to &quot;爬虫实战&quot;">​</a></h1><h2 id="实战1-爬取某视频首页视频" tabindex="-1">实战1:爬取某视频首页视频 <a class="header-anchor" href="#实战1-爬取某视频首页视频" aria-label="Permalink to &quot;实战1:爬取某视频首页视频&quot;">​</a></h2><h3 id="爬取内容" tabindex="-1">爬取内容: <a class="header-anchor" href="#爬取内容" aria-label="Permalink to &quot;爬取内容:&quot;">​</a></h3><p><img src="https://s2.loli.net/2022/07/13/a8HqniAPFS5TUME.png" alt="image-20220713203443427"></p><h3 id="爬取结果" tabindex="-1">爬取结果: <a class="header-anchor" href="#爬取结果" aria-label="Permalink to &quot;爬取结果:&quot;">​</a></h3><p><img src="https://s2.loli.net/2022/07/13/iGO1RNK6WwYxe37.png" alt="image-20220713204319757"></p><h3 id="实现过程及思路" tabindex="-1">实现过程及思路: <a class="header-anchor" href="#实现过程及思路" aria-label="Permalink to &quot;实现过程及思路:&quot;">​</a></h3><ol><li><p>从网页主页url中打开控制台，获取主页的html源码，利用<code>xpath</code>解析得到这一块的子页面<code>href</code>。</p></li><li><p>打开子页面的源代码，发现视频并不在其中，则通过network中的Fetch/XHR查找视频来源。</p></li><li><p>从中得到Request URL，进行requests.get发现获取失败，并得到以下内容。</p><img src="https://s2.loli.net/2022/07/13/5X6hv3YdDSLZzq7.png" alt="image-20220713210131646" style="zoom:67%;"></li><li><p>分析得到结果，是防盗链反爬导致的，回头找network内headers属性，将User-Agent,Cookie加入headers字典，再次使用requests.get发现仍然如此 ，最后发现是Referer防盗链造成的，Referer的值为子页面的href，将其组成键值对加入headers字典，再次进行requests.get，得到srcUrl。</p></li><li><p>对srcUrl进入发现还有最后一层反爬，通过比对正确的视频url和srcUrl发现：srcUrl是通过真正的url与systemTime组合修改的，找到其修改规律，用replace方法将systemTime改为f&#39;cont-{video_id}&#39;，得到最后正确的视频链接。</p></li><li><p>通过最后的write(requests.get(true_url).content)得到所需视频。</p></li></ol><h3 id="实现代码" tabindex="-1">实现代码: <a class="header-anchor" href="#实现代码" aria-label="Permalink to &quot;实现代码:&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">7.13 Kevin</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">防盗链处理 某视频 视频爬虫 爬取首页第一个大div里面所有视频</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> requests</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> lxml </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> html</span></span>
<span class="line"><span style="color:#A6ACCD;">etree </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> html</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">etree</span></span>
<span class="line"><span style="color:#A6ACCD;">url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.pearvideo.com/</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">tree </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> etree</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">HTML</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">res</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">text</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">href_list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tree</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">xpath</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">//*[@id=&quot;vervideoTlist&quot;]/div//@href</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">href_list</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> href </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> href_list</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.pearvideo.com/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> href</span></span>
<span class="line"><span style="color:#A6ACCD;">    video_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">_</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    params </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">contId</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> video_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    videoStatus </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.pearvideo.com/videoStatus.jsp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> params</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    new_url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> videoStatus</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">url</span></span>
<span class="line"><span style="color:#A6ACCD;">    headers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">User-Agent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Cookie</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__secdyid=e9d7070e31f729879bd4edec9f3db4567721f9f23769837d021657708580; acw_tc=2f624a1916577085808321223e1c9d5da783477514d7ff177f8220c470bbf8; JSESSIONID=2EF2FE6E5DE5C57BD7DAA3C0C372BE69; PEAR_UUID=dd85645b-e891-4615-a677-a8d2db1df2a2; _uab_collina=165770858183026495245603; Hm_lvt_9707bc8d5f6bba210e7218b8496f076a=1657708583; p_h5_u=B2141296-37D6-4117-87E8-E50BC33AFE84; Hm_lpvt_9707bc8d5f6bba210e7218b8496f076a=1657708644; SERVERID=ed8d5ad7d9b044d0dd5993c7c771ef48|1657708664|1657708580</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Referer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> url</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">new_url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">headers</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">headers</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    resp_json </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    fake_url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> resp_json</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">videoInfo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">videos</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">srcUrl</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 这里用切片方法组合得到真实的url再组合，没用对脑子,非常复杂</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># srcUrl = https://video.pearvideo.com/mp4/third/20220712/1657710591280-11905134-122533-hd.mp4</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># part_list1 = fake_url.split(&#39;/&#39;)[-1].split(&#39;-&#39;)[1:]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># part_list2 = fake_url.split(&#39;-&#39;)[0].split(&#39;/&#39;)[0:-1]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># part_left = &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># part_right = &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># for item in part_list1:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#     part_right += item+&#39;-&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># for it in part_list2:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#     part_left += it+&#39;/&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># true_url = part_left + &#39;cont-&#39;+video_id + &#39;-&#39; + part_right.strip(&#39;-&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 以下使用replace方法</span></span>
<span class="line"><span style="color:#A6ACCD;">    systemTime </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> resp_json</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">systemTime</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    true_url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fake_url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">systemTime</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;cont-</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">video_id</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#print(true_url)</span></span>
<span class="line"><span style="color:#A6ACCD;">    video_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">video_id</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">.mp4&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">video/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;">video_name</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">wb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> fw</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        resp2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">true_url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        fw</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">resp2</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">content</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h2 id="实战2-爬取某音乐评论" tabindex="-1">实战2:爬取某音乐评论 <a class="header-anchor" href="#实战2-爬取某音乐评论" aria-label="Permalink to &quot;实战2:爬取某音乐评论&quot;">​</a></h2><h3 id="爬取内容-1" tabindex="-1">爬取内容: <a class="header-anchor" href="#爬取内容-1" aria-label="Permalink to &quot;爬取内容:&quot;">​</a></h3><p><img src="https://s2.loli.net/2022/07/14/VYU6u3vpg92Ij7R.png" alt="image-20220714130414636"></p><h3 id="爬取结果-1" tabindex="-1">爬取结果: <a class="header-anchor" href="#爬取结果-1" aria-label="Permalink to &quot;爬取结果:&quot;">​</a></h3><h3 id="实现过程及思路-1" tabindex="-1">实现过程及思路: <a class="header-anchor" href="#实现过程及思路-1" aria-label="Permalink to &quot;实现过程及思路:&quot;">​</a></h3><ol><li><p>查看网页源代码，发现评论并没有在源代码内，转而找NetWork下对应评论的请求，查看headers。</p></li><li><p><img src="https://s2.loli.net/2022/07/14/Skq6uQ1yL2GMTxC.png" alt="image-20220714132316671"></p><p><img src="https://s2.loli.net/2022/07/14/rDvLUy7sa8TiHnx.png" alt="image-20220714132043044.png"></p><p>发现From Data内数据被加密。</p><div class="tip custom-block"><p class="custom-block-title">解决思路：</p><ol><li>找到未加密的参数</li><li>参考原来的加密逻辑加密自己的参数</li><li>请求到网址，得到加密信息</li></ol></div><p>步骤：</p><ol><li><p>寻找加密过程：</p><p><img src="https://s2.loli.net/2022/07/14/kwu7nvrbiaSsyZF.png" alt="image-20220714134944760.png"></p><p><img src="https://s2.loli.net/2022/07/14/BirJSIt3NlZpM5n.png" alt="image-20220714135602339.png"></p><p><img src="https://s2.loli.net/2022/07/14/6CSUQ3xpBlFywTP.png" alt="image-20220714135815208.png"></p><p>进入Call Stack查看上一步的，直至找到数据未加密的时候：</p><p><img src="https://s2.loli.net/2022/07/14/A7FWYifKpRZI39C.png" alt="image-20220714141748722.png"></p><p><img src="https://s2.loli.net/2022/07/14/rjkmUIBsneTwF3v.png" alt="image-20220714142056651.png"></p><p>观察后可得到加密函数如下：</p><p><img src="https://s2.loli.net/2022/07/14/t5flNAaSwB8K14y.png" alt="image-20220714142756520.png"></p><p>∴加密的过程为 windows.asrsea(加密前数据,xxx,xxx)</p><p>进一步找asrsea函数组的定义:</p><p><img src="https://s2.loli.net/2022/07/14/dxfWiu3HQsk4X1C.png" alt="image-20220714143906039.png"></p><p>所以具体实参对应：d=data参数, e=buV0x([&quot;流泪&quot;, &quot;强&quot;]), f=buV0x(Rg4k.md), g=buV0x([&quot;爱心&quot;, &quot;女孩&quot;, &quot;惊恐&quot;, &quot;大笑&quot;])【参数efg可以从Console运行得出以下结果】</p><p><img src="https://s2.loli.net/2022/07/14/5AwbUs7Y4mdecB2.png" alt="image-20220714144449898.png"></p><p>分析函数运行过程：在代码里有</p></li></ol></li></ol><h3 id="实现代码-1" tabindex="-1">实现代码: <a class="header-anchor" href="#实现代码-1" aria-label="Permalink to &quot;实现代码:&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">7.14 Kevin</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">网易云音乐 热评 爬虫</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> requests</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> Crypto</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Cipher </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> AES</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> base64 </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> b64encode</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">d </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">010001</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">f </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">g </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0CoJUm6Qyw8W8jud</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">kyM74e2babr6Ktf3</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">R_SO_4_28160882</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">threadId</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">R_SO_4_28160882</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pageNo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pageSize</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">20</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cursor</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">offset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">orderType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">csrf_token</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">4a42317491b25188649cd33d5ccfe8c4</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># data为解密前的数据</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_encSecKey</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">5015aaf2b9d0c1487908bf12cd0afdac506c4e7527cb6805ead6f4f6fa363aed69d876a0a9ecf18caaadc09ff9a61dcbf868657e15bbd0a24a44c41b499e19d5e9eede71d3f99232f965515aef8fc282f15b7ee7816fd9b5ac2d3784f385f03213ea8882edafe47bf88b3cd0f120f441f9246348fb2d75b6799f8548b021b04b</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_params</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 默认所得为字符串</span></span>
<span class="line"><span style="color:#A6ACCD;">    first </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enc_params</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> g</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    second </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enc_params</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">first</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> i</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> second</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_16</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    pad </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span></span>
<span class="line"><span style="color:#A6ACCD;">    data </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">chr</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">pad</span><span style="color:#89DDFF;">)*</span><span style="color:#A6ACCD;">pad</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> data</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enc_params</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    iv </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0102030405060708</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">to_16</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    aes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> AES</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">key</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">IV</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">iv</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">mode</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">AES</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">MODE_CBC</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 创建加密器</span></span>
<span class="line"><span style="color:#A6ACCD;">    bs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> aes</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encrypt</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 加密,加密的内容长度必须是16的倍数,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">b64encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">bs</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://music.163.com/weapi/comment/resource/comments/get?csrf_token=4a42317491b25188649cd33d5ccfe8c4</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 处理加密过程</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">function a(a) { # 返回随机16位字符串</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        for (d = 0; a &gt; d; d += 1)  # 循环16次</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">            e = Math.random() * b.length,   # 随机数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">            e = Math.floor(e),  # 取整</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">            c += b.charAt(e);   # 取字符串</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        return c</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    function b(a, b) {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        var c = CryptoJS.enc.Utf8.parse(b)  # b是秘钥</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">          , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">          , e = CryptoJS.enc.Utf8.parse(a)  # e是数据</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">          , f = CryptoJS.AES.encrypt(e, c, {    # c是加密的秘钥</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">            iv: d,  # 偏移量</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">            mode: CryptoJS.mode.CBC # 加密模式</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        });</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        return f.toString()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    function c(a, b, c) {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        var d, e;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        return setMaxDigits(131),</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        d = new RSAKeyPair(b,&quot;&quot;,c),</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        e = encryptedString(d, a)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    function d(d, e, f, g) {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        var h = {}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">          , i = a(16);  # i是16位随机字符串</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        return h.encText = b(d, g), # g是秘钥</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        h.encText = b(h.encText, i),    # 返回params，i是秘钥</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        h.encSecKey = c(i, e, f),   #得到encSecKey  8===D 此时i已经是一个定制，所以可def一个函数get_encSecKey</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        h</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    具体调用: var bKB1x = window.asrsea( d=JSON.stringify(i9b), e=buV0x([&quot;流泪&quot;, &quot;强&quot;]), f=buV0x(Rg4k.md), g=buV0x([&quot;爱心&quot;, &quot;女孩&quot;, &quot;惊恐&quot;, &quot;大笑&quot;]));</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    d:数据，e</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">={</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">params</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> get_params</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dumps</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)),</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">encSecKey</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> get_encSecKey</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">())</span></span></code></pre></div>`,18),t=[o];function e(c,r,D,y,F,i){return a(),n("div",null,t)}const f=s(p,[["render",e]]);export{C as __pageData,f as default};
