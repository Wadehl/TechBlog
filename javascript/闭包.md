# é—­åŒ…

::: info

é—­åŒ…æ˜¯æŒ‡åœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å‡½æ•°ï¼Œå®ƒå¯ä»¥è®¿é—®å¹¶æŒæœ‰å…¶æ‰€åœ¨ä½œç”¨åŸŸå†…çš„å˜é‡ï¼Œå³ä½¿åœ¨å…¶æ‰€åœ¨ä½œç”¨åŸŸå¤–éƒ¨è¢«è°ƒç”¨æ—¶ä»ç„¶æœ‰æ•ˆã€‚æ¢å¥è¯è¯´ï¼Œé—­åŒ…æ˜¯å‡½æ•°ä»¥åŠå…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒçš„ç»„åˆä½“ã€‚

é—­åŒ…é€šå¸¸åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‡ºç°ï¼š

- åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨å®šä¹‰äº†å¦ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”å†…éƒ¨å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚
- å†…éƒ¨å‡½æ•°è¢«è¿”å›ï¼Œæˆ–è€…è¢«ä¼ é€’ç»™å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œä»è€Œåœ¨å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸä¹‹å¤–è¢«è°ƒç”¨ã€‚

:::

```js
// ä¸¾ä¸ªğŸŒ°
function outerFunction() {
    let outerVariable = 'Kevin';
    return function innerFunction() {
        console.log(outerVariable);
    }
}

let closure = outerFunction();
closure(); // Kevin
```



::: tip

é—­åŒ…çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š

1. å¯ä»¥è®¿é—®å’ŒæŒæœ‰å¤–éƒ¨å‡½æ•°çš„å˜é‡å’Œå‚æ•°ï¼Œå³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚
2. å¤–éƒ¨å‡½æ•°çš„å˜é‡åœ¨é—­åŒ…ä¸­è¢«ä¿å­˜ï¼Œå½¢æˆäº†ä¸€ä¸ªé—­åŒ…ç¯å¢ƒã€‚
3. é—­åŒ…å¯ä»¥åœ¨å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸä¹‹å¤–è¢«è°ƒç”¨ï¼Œå»¶é•¿äº†å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚
4. é—­åŒ…å¯ä»¥è®¿é—®ä¸åŒå®ä¾‹ä¸­çš„ä¸åŒå˜é‡ï¼Œæ¯ä¸ªé—­åŒ…éƒ½æœ‰ç‹¬ç«‹çš„å¼•ç”¨ç¯å¢ƒã€‚

:::



é€šè¿‡ä½¿ç”¨é—­åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºç§æœ‰å˜é‡ã€å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–ã€å®ç°æ¨¡å—åŒ–ç­‰åŠŸèƒ½ã€‚é—­åŒ…åœ¨JavaScriptä¸­æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§å’Œå¸¸ç”¨çš„ç‰¹æ€§ï¼Œå®ƒä½¿å¾—å‡½æ•°å¯ä»¥æ‹¥æœ‰çŠ¶æ€å¹¶ä¸”èƒ½å¤Ÿä¿æŒå¯¹å…¶ç›¸å…³å˜é‡çš„è®¿é—®ã€‚

::: code-group

```js [ç§æœ‰å˜é‡ä¸æ¨¡å—åŒ–]
const myModule = (function() {
    let privateVar = "private Variable";

    function printPrivate() {
        console.log(privateVar);
    }

    return {
        printPublic: function() {
            printPrivate();
        },
        publicVar: 'public Var'
    }
})();

/**
* ç«‹å³æ‰§è¡Œå‡½æ•°ï¼ˆImmediately Invoked Function Expressionï¼ŒIIFEï¼‰åœ¨é—­åŒ…æ¨¡å—åŒ–ä¸­çš„ä½¿ç”¨æ˜¯ä¸ºäº†åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ä½œç”¨åŸŸã€‚
* ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°å‘¢ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š
* 	1. åˆ›å»ºç‹¬ç«‹çš„ä½œç”¨åŸŸï¼šç«‹å³æ‰§è¡Œå‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªç§æœ‰çš„ä½œç”¨åŸŸï¼Œé¿å…å…¨å±€å‘½åç©ºé—´æ±¡æŸ“å’Œå˜é‡å†²çªã€‚
*	2. å°è£…å®ç°ç»†èŠ‚ï¼šé€šè¿‡å°†æ¨¡å—çš„å®ç°ç»†èŠ‚å°è£…åœ¨ç«‹å³æ‰§è¡Œå‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥éšè—æ¨¡å—çš„å†…éƒ¨å®ç°ï¼Œåªæš´éœ²éœ€è¦å¯¹å¤–å…¬å¼€çš„æ¥å£ã€‚
*	3. é¿å…å˜é‡æå‡é—®é¢˜ï¼šç«‹å³æ‰§è¡Œå‡½æ•°å¯ä»¥é˜²æ­¢å˜é‡å’Œå‡½æ•°åœ¨å¤–éƒ¨è¢«æ„å¤–è®¿é—®æˆ–ä¿®æ”¹ï¼Œä¿æŒæ¨¡å—çš„å°è£…æ€§ã€‚
*/

myModule.printPublic(); // "private Variable"
console.log(myModule.privateVar, myModule.publicVar); // undefined "public Variable"
```

```js [å‡½æ•°æŸ¯é‡ŒåŒ–]
const curry = function(fn) {
    return function curried(...args) {
        // å¦‚æœå½“å‰æŸ¯é‡ŒåŒ–å‡½æ•°å‚æ•°ä¸ªæ•°å¤šäºæˆ–ç­‰äºfnçš„å‚æ•°ä¸ªæ•°(fn.length)ï¼Œè¯´æ˜å·²ç»æˆåŠŸæŸ¯é‡ŒåŒ–
        if(args.length >= fn.length) {
            // ä¸ºfnå…¥å‚
            return fn.apply(this, args);
        } else {
            return function(...args2) {
                // å¦åˆ™ï¼Œé“¾æ¥ä¸Šä¸€æ¬¡çš„å‚æ•°ä¸æ–°çš„å‚æ•°ï¼Œå¹¶ä¸”ç»§ç»­è°ƒç”¨curriedå‡½æ•°
                return curried.apply(this, args.concat(args2));
            }
        }
    }
}

const add = function(a, b, c) {
    return a+b+c;
}

const curriedAdd = curry(add);
console.log(curriedAdd(1)(2,3)); // 6
```

:::

## ä½œç”¨åŸŸé“¾ä¸thisæŒ‡å‘

:::info

ä¸€ä¸ªå®ä¾‹

```js
window.name = 'venki';

function f1() {
    return function {
        console.log(this.name, this);
    }
}

const obj = {
    name: 'kevin';
}

obj.f1 = f1;

obj.f1()(); // 'venki', window
```

:::

### obj.f1çš„ä½œç”¨åŸŸé“¾

![image-20230824181323917](/image-20230824181323917.png)

### thiså¯¹è±¡çš„é—®é¢˜

â€‹	åŒ¿åå‡½æ•°åœ¨è¿™ç§æƒ…å†µä¸‹ä¸ä¼šç»‘å®šåˆ°æŸä¸ªå¯¹è±¡ï¼Œè¿™å°±æ„å‘³ç€`this`ä¼šæŒ‡å‘`window`ï¼Œé™¤éåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ `this` æ˜¯ `undefined`ã€‚å¹¶ä¸”ï¼Œæ¯ä¸ªå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªç‰¹æ®Šå˜é‡ï¼š`this` å’Œ `arguments`ï¼Œæ‰€ä»¥å†…éƒ¨å‡½æ•°æ°¸è¿œä¸å¯èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„è¿™ä¸¤ä¸ªå˜é‡ã€‚ä½†æ˜¯å¯ä»¥æ”¹å†™`f1`,å­˜å‚¨`f1`ä¸­çš„`this`å¯¹è±¡ä¸ºå˜é‡`that`ï¼Œè¿”å›çš„åŒ¿åå‡½æ•°æ”¹ä¸º`that.name`ï¼Œå°±å¯ä»¥ä»é—­åŒ…ä¸­è¾“å‡º`obj.name`ã€‚

```js
// æ”¹å†™å
window.name = 'venki';

function f1() {
    const that = this;
    return function {
        console.log(that.name);
    }
}

const obj = {
    name: 'kevin',
}

obj.fun = f1;

obj.fun()(); // 'kevin'
```

::: tip

æŸ¥æ‰¾å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šé¡ºç€ä½œç”¨åŸŸé“¾ä»ä¸‹å¾€ä¸ŠæŸ¥æ‰¾ï¼Œå½“å½“å‰çš„ä½œç”¨åŸŸæ‰¾ä¸åˆ°å¯¹åº”çš„å¯¹è±¡ï¼Œä¼šç»§ç»­æ‰¾ä¸‹ä¸€ä¸ªä½œç”¨åŸŸï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚å› æ­¤ï¼Œé—­åŒ…å†…çš„å¯¹è±¡æ‰¾ä¸åˆ°thatï¼Œå°±ä¼šå»åˆ°f1é‡Œé¢æ‰¾thatï¼Œæ­¤æ—¶çš„thatå­˜å‚¨çš„å³æ˜¯f1çš„thisï¼Œå³obj

:::

#### æ”¹å˜åçš„ä½œç”¨åŸŸé“¾

![image-20230824183006102](/image-20230824183006102.png)