---
layout: doc
outline: deep
---



# HTTPä¸­çš„å¼ºç¼“å­˜ä¸Žåå•†ç¼“å­˜

## æµè§ˆå™¨ç¼“å­˜æœºåˆ¶

å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªç½‘å€çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®URLåŽ»è¯·æ±‚æœåŠ¡å™¨ä»¥èŽ·å–æ‰€éœ€è¦çš„æ•°æ®èµ„æºï¼Œè¿™ä¸€è¿‡ç¨‹å¯èƒ½ä¼šå¯¼è‡´é¡µé¢æœ‰ä¸€æ®µç™½å±æ—¶é—´ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨éœ€è¦ç­‰å¾…æœåŠ¡å™¨è¿”å›žæ•°æ®ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨æ˜¯å¤„äºŽç­‰å¾…çŠ¶æ€çš„ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é¡µé¢çš„ç™½å±æ—¶é—´å˜é•¿ï¼Œç”¨æˆ·ä½“éªŒå˜å·®ã€‚

å› æ­¤ï¼Œå½“æˆ‘ä»¬éœ€è¦æé«˜ç”¨æˆ·ä½“éªŒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸€äº›ç¼“å­˜æŠ€æœ¯ï¼Œå¦‚ï¼šDNSç¼“å­˜ã€CDNç¼“å­˜ã€HTTPç¼“å­˜ç­‰ï¼Œè‰¯å¥½çš„ç¼“å­˜ç­–ç•¥å¯ä»¥é™ä½Žé‡å¤èµ„æºçš„è¯·æ±‚ï¼Œé™ä½ŽæœåŠ¡å™¨çš„å¼€é”€ï¼Œæå‡ç”¨æˆ·çš„é¡µé¢åŠ è½½é€Ÿåº¦ã€‚

## HTTPç¼“å­˜

### åŸºæœ¬åŽŸç†

HTTPç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ ä¸€äº›å­—æ®µï¼Œè¿™äº›å­—æ®µä¼šå‘Šè¯‰æµè§ˆå™¨å¦‚ä½•å¤„ç†è¿™äº›èµ„æºï¼Œæµè§ˆå™¨ä¼šæ ¹æ®è¿™äº›å­—æ®µæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ç¼“å­˜è¿™äº›èµ„æºï¼Œä»¥åŠç¼“å­˜å¤šé•¿æ—¶é—´ï¼Œå½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚è¿™äº›èµ„æºæ—¶ï¼Œä¼šæ ¹æ®è¿™äº›å­—æ®µæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨ç¼“å­˜ã€‚

HTTPç¼“å­˜åˆ†ä¸ºå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œå¼ºç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨ä¸éœ€è¦å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè€Œæ˜¯ç›´æŽ¥ä»Žæœ¬åœ°ç¼“å­˜ä¸­èŽ·å–èµ„æºï¼Œåå•†ç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨ä¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨æ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€‚

### å¼ºç¼“å­˜ ðŸ¦¸

å¼ºç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨èµ„æºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ `Cache-Control`å’Œ`Expires`å­—æ®µï¼Œè¿™ä¸¤ä¸ªå­—æ®µä¼šå‘Šè¯‰æµè§ˆå™¨å¦‚ä½•å¤„ç†è¿™äº›èµ„æºï¼Œæµè§ˆå™¨ä¼šæ ¹æ®è¿™äº›å­—æ®µæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ç¼“å­˜è¿™äº›èµ„æºï¼Œä»¥åŠç¼“å­˜å¤šé•¿æ—¶é—´ï¼Œå½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚è¿™äº›èµ„æºæ—¶ï¼Œä¼šæ ¹æ®è¿™äº›å­—æ®µæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨ç¼“å­˜ã€‚

#### å¼ºç¼“å­˜ç›¸å…³å­—æ®µ

##### 1. pragma

`pragma`æ˜¯HTTP/1.1ä¹‹å‰é—ç•™çš„é€šç”¨é¦–éƒ¨å­—æ®µï¼Œåªæœ‰`no-cache`è¿™ä¸€å¯é€‰å€¼ï¼Œå½“`no-cache`å­˜åœ¨æ—¶ï¼Œä¸€å®šä¸ä¼šå‘½ä¸­å¼ºç¼“å­˜ã€‚

##### 2. Cache-Control

`Cache-Control`æ˜¯HTTP/1.1ä¸­ç”¨æ¥æŽ§åˆ¶ç¼“å­˜çš„å­—æ®µï¼Œå®ƒå¯ä»¥è®¾ç½®å¤šä¸ªå€¼ï¼Œæ¯ä¸ªå€¼ä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œå¸¸ç”¨çš„å€¼æœ‰ï¼š

- `public`ï¼šè¡¨ç¤ºèµ„æºå¯ä»¥è¢«ä»»ä½•å¯¹è±¡ï¼ˆåŒ…æ‹¬ï¼šå‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œä»£ç†æœåŠ¡å™¨ï¼Œç­‰ç­‰ï¼‰ç¼“å­˜ã€‚
- `private`ï¼šè¡¨ç¤ºèµ„æºåªèƒ½è¢«å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯ç¼“å­˜ï¼Œä¸èƒ½è¢«ä»£ç†æœåŠ¡å™¨ï¼ˆCDNï¼‰ç¼“å­˜ã€‚
- `no-cache`ï¼šè¡¨ç¤ºèµ„æºå¯ä»¥è¢«ç¼“å­˜ï¼Œä½†æ˜¯æ¯æ¬¡åœ¨ä½¿ç”¨ç¼“å­˜èµ„æºæ—¶ï¼Œéƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ¥åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€‚
- `no-store`ï¼šè¡¨ç¤ºèµ„æºä¸å¯ä»¥è¢«ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚
- `max-age`ï¼šè¡¨ç¤ºèµ„æºå¯ä»¥è¢«ç¼“å­˜çš„æœ€å¤§æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚

::: tip

- 'no-cache'å¹¶ä¸æ„å‘³ç€ä¸å¯ä»¥è¿›è¡Œç¼“å­˜ï¼Œè€Œæ˜¯æ¯æ¬¡åœ¨ä½¿ç”¨ç¼“å­˜èµ„æºæ—¶ï¼Œéƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼Œæœ‰æ•ˆæ‰ä¼šä½¿ç”¨ç¼“å­˜ï¼ˆ`åå•†ç¼“å­˜`ï¼‰ - 'no-store'æ‰è¡¨ç¤ºä¸å¯ä»¥è¿›è¡Œç¼“å­˜
- `Chrome`å¼ºåˆ¶åˆ·æ–°(`Ctrl+F5`)çš„å®žçŽ°æ–¹å¼ä¸ºï¼Œåœ¨è¯·æ±‚çš„é¦–éƒ¨æ·»åŠ `pragma: no-cache`ä¸Ž`cache-control: no-cache`å®žçŽ°

â€‹	![image-20230501214334004](/image-20230501214334004.png)

- `max-age`çš„å€¼ä¸ºéž0æˆ–è®¾ç½®äº†å¤§äºŽè¯·æ±‚æ—¥æœŸçš„`Expires`æ‰å¯èƒ½å‘½ä¸­å¼ºç¼“å­˜ï¼Œå¹¶ä¸”åªæœ‰`cache-control`ä¸å­˜åœ¨`no-cache`/`no-store`ä»¥åŠ`pragma`çš„æ—¶å€™ï¼Œæ‰ä¼šå‘½ä¸­å¼ºç¼“å­˜
- `max-age=0`çš„æ—¶å€™ï¼Œä¸Ž`cache-control: no-cache`æ•ˆæžœç±»ä¼¼

:::

##### 3. Expires

`Expires`æ˜¯ä¸€ä¸ªå“åº”å¤´å­—æ®µï¼Œåªæœ‰å½“`Expires`æ—¥æœŸå‰çš„æ—¶å€™ï¼ŒHTTPç¼“å­˜æœ‰æ•ˆã€‚å¹¶ä¸”å½“`cache-control`å«`max-age`çš„æ—¶å€™ï¼Œè¯¥å­—æ®µè¢«å¿½ç•¥ã€‚



### å¼±ç¼“å­˜ï¼ˆåå•†ç¼“å­˜ï¼‰ðŸ•µï¸

#### å¼±ç¼“å­˜ç›¸å…³å­—æ®µ

##### 1. Last-Modified/If-Modified-Since

â€‹	`If-Modified-Since`æ˜¯è¯·æ±‚å¤´ä¸­çš„ä¸€ä¸ªå­—æ®µï¼ˆåªèƒ½ç”¨äºŽ`GET`ä¸Ž`Head`è¯·æ±‚ï¼‰ï¼Œè€Œ`Last-Modified`æ˜¯å“åº”å¤´ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚å½“å¸¦ç€`If-Modified-Since`çš„è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°†æ£€æŸ¥`Last-Modified`ï¼Œå¦‚æžœ`Last-Modified`æ—©äºŽæˆ–ç­‰äºŽ`If-Modified-Since`ï¼Œåˆ™è¿”å›ž`304`å“åº”ï¼Œå¦åˆ™é‡æ–°è¿”å›žæ–°çš„èµ„æºã€‚

##### 2. ETag/If-None-Match

â€‹	`If-None-Match`æ˜¯è¯·æ±‚å¤´çš„ä¸€ä¸ªå­—æ®µï¼Œ`ETag`æ˜¯å“åº”å¤´çš„ä¸€ä¸ªå­—æ®µï¼Œå®ƒæ˜¯æ ¹æ®èµ„æºçš„å†…å®¹ç”Ÿæˆçš„ä¸€æ®µ`Hash`å€¼ã€‚å½“å¸¦ç€`ETag`çš„è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šå¯»æ‰¾ä¸Žä¹‹åŒ¹é…çš„èµ„æºï¼Œå¦‚æžœæœ‰åˆ™è¿”å›ž`304`å“åº”ï¼Œå¦åˆ™è¿”å›ž`200`å“åº”ä¸Žæ–°çš„èµ„æºã€‚



::: tip ä¸ºä»€ä¹ˆéœ€è¦ETag

1. åœ¨æ²¡æœ‰ä¿®æ”¹æ–‡ä»¶å†…å®¹çš„æƒ…å†µä¸‹ï¼Œæ–‡ä»¶æœ€åŽä¿®æ”¹æ—¥æœŸå¯èƒ½ä¼šå˜ï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„è¯·æ±‚
2. å½“æŸäº›æ–‡ä»¶åœ¨==1ç§’==å†…è¿›è¡Œäº†ä¿®æ”¹ï¼Œ`Last-Modified`å¯èƒ½ç›‘æµ‹ä¸åˆ°
3. æŸäº›æœåŠ¡å™¨æ— æ³•ç²¾ç¡®èŽ·å–åˆ°æ–‡ä»¶çš„ä¿®æ”¹æ—¥æœŸ

:::



### å¯å‘å¼ç¼“å­˜

â€‹	å½“ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ²¡æœ‰`expires`ä¹Ÿæ²¡æœ‰`cache-control`ï¼Œä½†æ˜¯æœ‰`last-modified`çš„æ—¶å€™,æµè§ˆå™¨ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ç¼“å­˜ç­–ç•¥:

`(currentTime - Last-Modified) * 0.1`



[HTTP Heuristic Caching (Missing Cache-Control and Expires Headers) Explained](https://paulcalvano.com/2018-03-14-http-heuristic-caching-missing-cache-control-and-expires-headers-explained/)



### ç¼“å­˜æ€»æµç¨‹

![æ•´ä½“æµç¨‹](/161233e6685e5e73tplv-t2oaga2asx-zoom-in-crop-mark4536000.webp)





::: details ä¸¾ä¸ªä¾‹å­ðŸŒ°

ç¬¬ä¸€æ¬¡è®¿é—®æœ¬é¡µçš„æ—¶å€™ï¼š

![ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æº](/image-20230501213045868.png)

å¯ä»¥çœ‹åˆ°å“åº”å¤´æœ‰`Cache-Control: no-cache`ä»¥åŠ`ETag`ä¸Ž`Last-Modified`ï¼Œè¯´æ˜Žï¼Œæ­¤æ—¶ä¸ºåå•†ç¼“å­˜ã€‚

ç¬¬äºŒæ¬¡å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œå°†ä¼šæ¯”å¯¹è¯·æ±‚å¤´ä¸­çš„`If-None-Match`ä¸Ž`If-Modified-Since`å­—æ®µã€‚



![image-20230501233831904](/image-20230501233831904.png)

å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶`If-None-Match`ä¸Ž`ETag`æ˜¯åŒ¹é…çš„ï¼Œ`If-Modified-Since`ä¹Ÿç¬¦åˆ`Last-Modified`çš„è¦æ±‚ï¼Œå› æ­¤ï¼ŒæœåŠ¡å™¨è¿”å›ž`304`å“åº”ï¼Œå…è®¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚

:::



::: info é™„

### çŠ¶æ€ç åŒºåˆ«

- `200` è¯·æ±‚æˆåŠŸï¼ŒæœåŠ¡å™¨è¿”å›žå…¨æ–°çš„èµ„æº
- `200` `from memory cache / from disk cache` æœ¬åœ°å¼ºç¼“å­˜è¿˜åœ¨æœ‰æ•ˆæœŸï¼Œç›´æŽ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚ å…¶ä¸­ï¼Œ`from memory cache`è¡¨ç¤ºé¡µé¢åˆ·æ–°çš„æ—¶å€™ï¼Œä»Žå†…å­˜ä¸­èŽ·å–ç¼“å­˜ï¼Œ`from disk cache`è¡¨ç¤ºæ ‡ç­¾é¡µå…³é—­åŽä»Žç£ç›˜èŽ·å–ç¼“å­˜
- `304` è¯·æ±‚æˆåŠŸï¼ŒæœåŠ¡å™¨åˆ¤æ–­`ETag`ä¸Ž`Last-Modified`æ²¡æœ‰è¿‡æœŸï¼Œå‘ŠçŸ¥æµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜



### ç¼“å­˜ä¼˜å…ˆçº§

â€‹	`oragma > cache-control > expires > Etag > Last-Modified`

:::
